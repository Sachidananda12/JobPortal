<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | YourJob</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background-color: #f9f9f9;
      font-family: 'Segoe UI', sans-serif;
    }
    .navbar-brand:hover, .nav-link:hover {
      color: #00ffc3 !important;
      transition: 0.3s ease-in-out;
    }
    .card:hover {
      transform: scale(1.01);
      transition: 0.3s ease;
    }
    .progress-circle circle:nth-child(2) {
      stroke-linecap: round;
      transition: stroke-dashoffset 1s ease-in-out;
    }
  </style>
</head>
<body>

<!-- âœ… Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm py-3 sticky-top">
  <div class="container">
    <a class="navbar-brand fw-bold fs-4" href="{% url 'home' %}">
      <i class="bi bi-briefcase-fill me-2"></i>Your<span class="text-success">Job</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dashboardNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="dashboardNavbar">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link px-3 active" href="#">Dashboard</a>
        </li>
      </ul>
      <div class="d-flex gap-3 align-items-center">
        <span class="text-white small">Hello, <strong>{{ request.user.username }}</strong> ðŸ‘‹</span>
        <a href="{% url 'logout' %}" class="btn btn-outline-light btn-sm px-4">
          <i class="bi bi-box-arrow-right me-1"></i>Logout
        </a>
      </div>
    </div>
  </div>
</nav>

<!-- âœ… Search Bar -->
<div class="container mt-4">
  <form method="get" class="row justify-content-center mb-4">
    <div class="col-md-6">
      <div class="input-group">
        <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Search job title or company name">
        <button class="btn btn-outline-primary" type="submit">
          <i class="bi bi-search"></i> Search
        </button>
      </div>
    </div>
  </form>
</div>

<!-- âœ… Main Content -->
<div class="container mt-5">
  <div class="row">

    <!-- âœ… Left Sidebar: Profile Card with Progress -->
    <div class="col-md-3 mb-3">
      <div class="card border-0 shadow-lg rounded-4 bg-white">
        <div class="card-body text-center p-4">

          <!-- âœ… Circular Progress -->
          <div class="progress-circle position-relative mx-auto mb-3" style="width: 140px; height: 140px;">
            <svg class="position-absolute top-0 start-0" width="140" height="140">
              <!-- Grey background circle -->
              <circle cx="70" cy="70" r="60" stroke="#e9ecef" stroke-width="10" fill="none" />
              <!-- Green progress circle -->
              <circle cx="70" cy="70" r="60" stroke="#28a745" stroke-width="10" fill="none"
                stroke-dasharray="377"
                stroke-dashoffset="{{ stroke_offset }}" />
            </svg>

            <!-- Profile Image -->
            {% if profile and profile.image %}
              <img src="{{ profile.image.url }}" class="rounded-circle shadow position-absolute top-50 start-50 translate-middle"
                   width="100" height="100" alt="Profile Picture" style="object-fit: cover;">
            {% else %}
              <img src="https://ui-avatars.com/api/?name={{ request.user.username }}&background=0D8ABC&color=fff&size=100"
                   class="rounded-circle shadow position-absolute top-50 start-50 translate-middle"
                   width="100" height="100" alt="Default Avatar" style="object-fit: cover;">
            {% endif %}
          </div>

          <!-- âœ… Completion Text -->
          <p class="text-success fw-bold mb-3">Profile Completed: {{ percent }}%</p>

          <h5 class="fw-bold mb-1">{{ profile.full_name|default:request.user.username }}</h5>
          <p class="text-muted small mb-3">{{ request.user.email }}</p>

          <ul class="list-group list-group-flush text-start small">
            <li class="list-group-item bg-transparent border-0">
              <i class="bi bi-telephone-fill text-success me-2"></i>
              <strong>Phone:</strong> {{ profile.phone|default:"N/A" }}
            </li>
            <li class="list-group-item bg-transparent border-0">
              <i class="bi bi-gender-ambiguous text-primary me-2"></i>
              <strong>Gender:</strong> {{ profile.gender|default:"N/A" }}
            </li>
            <li class="list-group-item bg-transparent border-0">
              <i class="bi bi-briefcase-fill text-warning me-2"></i>
              <strong>Job Profile:</strong> {{ profile.job_profile|default:"N/A" }}
            </li>
          </ul>

          <a href="#" class="btn btn-outline-success btn-sm mt-3">
            <i class="bi bi-pencil-square me-1"></i> Edit Profile
          </a>
        </div>
      </div>
    </div>

    <!-- âœ… Right Side: Job Cards -->
    <div class="col-md-8">
      {% if jobs %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for job in jobs %}
            <div class="col">
              <div class="card h-100 border-0 shadow-sm rounded-4">
                <div class="card-body">
                  <h5 class="card-title text-dark">{{ job.title }}</h5>
                  <h6 class="card-subtitle text-muted mb-2">
                    <i class="bi bi-building me-1 text-secondary"></i>{{ job.company }} â€“
                    <i class="bi bi-geo-alt-fill me-1 text-danger"></i>{{ job.location }}
                  </h6>
                  <p class="card-text text-muted small">{{ job.description|truncatechars:100 }}</p>
                  <a href="{% url 'apply_job' job.id %}" class="btn btn-sm btn-primary">
                    <i class="bi bi-send-fill me-1"></i>Apply Now
                  </a>
                </div>
                <div class="card-footer text-muted small bg-light border-top">
                  <i class="bi bi-calendar-check me-1"></i>Posted on {{ job.created_at|date:"M d, Y" }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center mt-5">
          <h5 class="text-muted">No jobs found matching your search.</h5>
        </div>
      {% endif %}
    </div>

  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
